<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Global Cancer Information (2022)</title>
  <link rel="stylesheet" href="style.css"> 
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>
  <style>
    .vega-actions a { margin-right: 5px; }
    .chart-container { margin-bottom: 40px; }
  </style>
</head>
<body>
<div class="header">
  <h1 class="title">Global Cancer Information (2022)</h1>
</div>

<div class="content">
    <h5 class="subtitle">* ASR = Age-Standardized Rate per 100,000 population</h5>
    <div id="combined" class="content_map"></div>
</div>

  <script>
    var vlSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v6.json",
      config: { view: { stroke: null } },
      background: "#e5cefcfe",
      center: true,  
      
      params: [
        {
            name: "SelectedContinents",
            bind: {
                input: "select",
                options: ["Select All", "Asia", "Europe", "Africa", "North America", "Oceania", "South America"],
                multiple: true,
                size: 180,
                name: "Select Continents: "
            },
            value: ["Select All"]   // default checked
        }
    ],

    vconcat: [
        // Choropleth Map
        {
          title: {
            text: " NEW Global Cancer Prevalence Cases (2022)",
            fontSize: 20,
            anchor: "start",
            color: "#3d0477",
            offset: 20
          },
          width: 700,
          height: 500,
          projection: { type: "equalEarth"},

          layer: [
            {
              data: {
                url: "https://vega.github.io/vega-datasets/data/world-110m.json",
                format: { type: "topojson", feature: "countries" }
              },
              mark: { type: "geoshape", fill: "darkgray", stroke: "black", strokeWidth: 0.5 }
            },
            {
              data: {
                url: "https://vega.github.io/vega-datasets/data/world-110m.json",
                format: { type: "topojson", feature: "countries" }
              },
              transform: [
                {
                  lookup: "id",
                  from: {
                    data: { url: "prevalence_mortality_updt.csv" },
                    key: "NumericCode",
                    fields: ["Country","PrevalenceCases", "Continent"]
                  }
                },
                { filter: "indexof(SelectedContinents, 'Select All') >= 0 || indexof(SelectedContinents, datum.Continent) >= 0" }

              ],
              mark: { type: "geoshape", stroke: "black", strokeWidth: 1.5 },
              encoding: {
                color: {
                  field: "PrevalenceCases",
                  type: "quantitative",
                  align: "left",
                  scale: { scheme: "reds" },
                  legend: { title: "Prevalence Cases (ASR)" }
                },
                tooltip: [
                  { field: "Country", type: "nominal" },
                  { field: "PrevalenceCases", type: "quantitative" }
                ]
              }
            }
          ]
        },

        // Slope Graph
        {
          title: {
            text: "Global Cancer Incidence and Mortality Rate for each Continent (2022)",
            fontSize: 20,
            anchor: "start",
            color: "#3d0477",
            offset: 20
          },
          width: 700,
          height: 800,         
          data: { url: "slope.csv" },
          config: {
            view: {
                stroke: null,
                fill: "#e5cefcfe"
            }
        },
          transform: [
            {
              joinaggregate: [
                { op: "max", field: "Cancer ASR rate", as: "incidence" }
              ],
              groupby: ["Country"]
            },
            {
              window: [
                { op: "rank", field: "incidence", as: "rank" }
              ],
              sort: [{ field: "incidence", order: "descending" }]
            },
            { filter: "indexof(SelectedContinents, 'Select All') >= 0 || indexof(SelectedContinents, datum.Continent) >= 0" }

          ],
           encoding: {
            x: { 
                field: "Measure",
                type: "nominal",
                sort: ["Incidence","Mortality"],
                scale: { paddingInner: 0.1, paddingOuter: 0.01 },
                axis: {
                    domain: false,
                    ticks: false, 
                    labels: true,
                    labelFontSize: 14,
                    labelPadding: 20,
                    title: null,
                    labelAngle: 0,
                    labelAlign: "center",
                    labelBaseline: "top"
                }
            },
            y: { 
                field: "Cancer ASR rate",
                type: "quantitative",
                scale: { domain: [0, 300], nice: true },
                axis: { 
                    title: "Age-Standardized Rate (per 100,000 population)",
                    grid: true,        
                    tickCount: 12,       
                    labelFontSize: 11,
                    labelColor: "black",
                    gridColor: "grey",
                    ticksColor: "grey",
                    gridDash: [4,4],
                }
            },
            color: {
              field: "Continent",
              type: "nominal",
              scale: {
                domain: ["Africa", "Asia", "Europe", "North America", "Oceania", "South America"],
                range: [
                  "#1f77b4",  // dark blue
                  "#ff7f0e",  // deep orange
                  "#2ca02c",  // dark green
                  "#d62728",  // dark red
                  "#9467bd",  // dark purple
                  "#8c564b"   // brown
                ]
              },
              legend: { title: "Continent" }
            }
          },
          
          layer: [
            {
              mark: { type: "line", strokeWidth: 2 },
              encoding: {
                detail: { field: "Continent" },
                color: { field: "Continent", type: "nominal"}
              }
            },
            {
              mark: { type: "point", filled: true, size: 70},
              encoding: {
                detail: { field: "Continent" },
                color: { field: "Continent", type: "nominal" },
                tooltip: [
                    { field: "Continent", type: "nominal" },
                    { field: "Measure", type: "nominal" },
                    { field: "Cancer ASR rate", type: "quantitative" }
                ]
              }
            },
            
                      
            {
              transform: [
                    {
                        calculate: "datum.Measure == 'Mortality' ? (datum.Continent == 'Europe' ? -5: datum.Continent == 'Oceania' ? -5 : datum.Continent == 'North America' ? 10 : datum.Continent == 'South America' ? -5 : datum.Continent == 'Asia' ? -3 : datum.Continent == 'Africa' ? 20 : 0) : (datum.Continent == 'Europe' ? -5 : datum.Continent == 'Oceania' ? -5 : datum.Continent == 'North America' ? -10 : datum.Continent == 'South America' ? -5 : datum.Continent == 'Asia' ? -5 : datum.Continent == 'Africa' ? -5 : 0)",
                        as: "labelOffsetdx"
                    },
                    {
                        calculate: "datum.Measure == 'Mortality' ? (datum.Continent == 'Europe' ? 5: datum.Continent == 'Oceania' ? 5 : datum.Continent == 'North America' ? 5 : datum.Continent == 'South America' ? 5 : datum.Continent == 'Asia' ? 5 : datum.Continent == 'Africa' ? 5 : 0) : (datum.Continent == 'Europe' ? 5 : datum.Continent == 'Oceania' ? 5 : datum.Continent == 'North America' ? 5 : datum.Continent == 'South America' ? 5 : datum.Continent == 'Asia' ? 5 : datum.Continent == 'Africa' ? 5 : 0)",
                        as: "labelOffsetdy"
                    }
                ],
                mark: {
                    type: "text",
                    align: "left",
                    baseline: "middle",
                    dx: { expr: "datum.labelOffsetdx" },
                    dy: { expr: "datum.labelOffsetdy" },
                    fontSize: 15,
                    fontWeight: "bold"
                },
                encoding: {
                    x: { field: "Measure", type: "nominal" },
                    y: { field: "Cancer ASR rate", type: "quantitative" },
                    text: { field: "Cancer ASR rate", type: "quantitative", format: ".1f" },
                    color: { field: "Continent", type: "nominal" },
                    detail: { field: "Continent" },
                }
            },
            {
                mark: { 
                    type: "rule", 
                    stroke: "black", 
                    strokeWidth: 1,
                }, 
                encoding: { 
                    x: { datum: "Incidence",type: "nominal", band: 0},
                    y: { datum: 0 },
                    y2: { datum: 300 }
                } 
            },
            {
                mark: { 
                    type: "rule", 
                    stroke: "black", 
                    strokeWidth: 1 
                }, 
            encoding: { 
                x: { datum: "Mortality", type: "nominal", band: 0.5 },
                y: { datum: 0 },
                y2: { datum: 300 }
            } 
        }
    ]
}

      ]
    };

    vegaEmbed("#combined", vlSpec, { actions: false });
  </script>
</body>
</html>
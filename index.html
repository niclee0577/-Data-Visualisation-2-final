<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Global Cancer Information (2022)</title>
  <link rel="stylesheet" href="style.css"> 
  <script src="https://cdn.jsdelivr.net/npm/vega@6.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@6.4.1"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@7.0.2"></script>
  <style>
  </style>
</head>
<body>
<div class="header">
  <h1 class="title">Global Cancer Mortality and Incidence Information (2022)</h1>
</div>

<div class="content">
    <h5 class="subtitle">* ASR = Age-Standardized Rate per 100,000 population</h5>
    <div id="combined" class="content_map"></div>
    <div id="dotchart" class="content_map"></div>

</div>

  <script>
    var vlSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v6.json",
      config: {
        view: {
          stroke: null,
          facet: { spacing: 0 },
          padding: 0 
        },
      },
      autosize: { type: "fit", contains: "padding"},
      background: "#e5cefcfe", 
      params: [
        {
            name: "SelectedContinents",
            bind: {
                input: "select",
                options: ["Select All", "Asia", "Europe", "Africa", "North America", "Oceania", "South America"],
                multiple: true,
                size: 180,
                name: "Please Select Continents: ",
                
            },
            value: ["Select All"],   // default checke
        }
    ],

    vconcat: [
        // Choropleth Map
        {
          width: 900,
          height: 500,
          projection: { 
            type: "equalEarth",
          },
          layer: [
          
          // Ocean Backgrond
          {
            data:{
              values: [{type: "Sphere"}]
            },
            mark: {type: "geoshape", fill:"#cce6ff" }
          },

          //graticule grid
          {
            data: {
              graticule: {}
            },
            mark: {
              type: "geoshape",
              stroke: "#d1d1d1",
              strokeWidth: 0.5
            },
            projection: {type: "equalEarth"}
          },

          // map outline  
          {
            data: {
              url: "https://vega.github.io/vega-datasets/data/world-110m.json",
              format: { type: "topojson", feature: "countries" }
            },
            mark: { type: "geoshape", fill: "darkgray", stroke: "black", strokeWidth: 0.5 }
          },
          
          // map with data
          {
            data: {
              url: "https://vega.github.io/vega-datasets/data/world-110m.json",
              format: { type: "topojson", feature: "countries" }
            },
            transform: [
              {
                lookup: "id",
                from: {
                  data: { url: "prevalence_mortality_updt.csv" },
                  key: "NumericCode",
                  fields: ["Country","PrevalenceCases", "Continent"]
                }
              },
              { filter: "indexof(SelectedContinents, 'Select All') >= 0 || indexof(SelectedContinents, datum.Continent) >= 0" }

            ],
            mark: { type: "geoshape", stroke: "black", strokeWidth: 1.5 },
            encoding: {
              color: {
                field: "PrevalenceCases",
                type: "quantitative",
                align: "left",
                scale: { scheme: "reds" },
                legend: { title: ["Prevalence Cases", "(ASR)"], titleFontSize: 16, labelFontSize: 15, offset: -140}    
              },
              tooltip: [
                { field: "Country", type: "nominal" },
                { field: "PrevalenceCases", type: "quantitative" }
              ]
            }
          }
          ]
        },

        {
          hconcat: [
          // multi donut chart
        {
          vconcat: [  
        // incidence
        {
          data: { url: "multi_donutchart_in_check_updt.csv" },  
          dx: 100,
          columns: 3,
          facet: {
              field: "Continent",
              type: "nominal",
              bounds: "flush",
              columns: 3,
              header: {
                title: "Continent (Incidence)",
                titleFontSize: 14, 
                labelFontSize: 13,
                labelAlign: "center",
                labelExpr: "indexof(SelectedContinents, 'Select All') >= 0 ? datum.label : (indexof(SelectedContinents, datum.value) >= 0 ? datum.label : '')"
              }
          },
          view: { continuousWidth: 600, continuousHeight: 300 }, 
          resolve: { scale: { x: "independent", y: "independent"} },    
          spec: {
            width: 140,
            height: 130,
            autosize: { type: "none" },
            config: { view: { stroke: null } },
            layer: [
              {
                mark: { type: "arc", innerRadius: 20 ,outerRadius: 35},
                encoding: {
                  theta: {
                    field: "Gender Percentage",
                    type: "quantitative"
                  },
                  color: {
                    field: "Gender",
                    type: "nominal",
                    scale: { 
                      range: [
                        "#B80065",      // dark pink
                        "#120174"       // dark blue
                      ] 
                    },
                    legend: { title: "Gender", titleFontSize: 16, labelFontSize: 15},
                  },
                  opacity: {
                    condition: {
                      test: "indexof(SelectedContinents, datum.Continent) >= 0 || indexof(SelectedContinents, 'Select All') >= 0",
                      value: 1      
                    },
                    value: 0      
                  },
                  tooltip: [
                    {field: "Continent",type: "nominal"},
                    {field: "Gender",type: "nominal"},
                    {field: "Gender Percentage",type: "quantitative", format: ".1f"}
                ]
                }
              },
              {
                mark: { 
                  type: "text", 
                  radius: 50,
                  fontSize: 14,
                  fontWeight: "bold"
                },
                encoding: {
                  theta: {
                    field: "Gender Percentage",
                    type: "quantitative",
                    stack: true,
    
                  },
                  text: {
                    field: "Gender Percentage",
                    type: "quantitative",
                    format: ".1f"
                  },
                  color: {
                    field: "Gender",
                    type: "nominal",
                    scale: { 
                      range: [
                        "#B80065",
                        "#120174"
                      ] 
                    },
                    legend: null
                  },
                  opacity: {
                    condition: {
                      test: "indexof(SelectedContinents, datum.Continent) >= 0 || indexof(SelectedContinents, 'Select All') >= 0",
                      value: 1
                    },
                    value: 0
                  },
                }
              }
              
            ]
          }
        },
        
        // mortality
        {
          data: { url: "multi_donutchart_mor_check_updt.csv" },
          // transform: [
          //   { filter: "indexof(SelectedContinents, 'Select All') >= 0 || indexof(SelectedContinents, datum.Continent) >= 0" }
          // ],
          columns: 3,
          
          facet: {
              field: "Continent",
              type: "nominal",
              bounds: "flush",
              header: {
                title: "Continent (Mortality)",
                titleFontSize: 14, 
                labelFontSize: 13,
                labelExpr: "indexof(SelectedContinents, 'Select All') >= 0 ? datum.label : (indexof(SelectedContinents, datum.value) >= 0 ? datum.label : '')"
              }
          },
          spec: {
            width: 140,
            height: 130,
            autosize: { type: "none" },
            config: { view: { stroke: null } },
            resolve: { scale: { x: "independent", y: "independent" } },
            view: { continuousWidth: 600, continuousHeight: 300},
            layer: [
              {
                mark: { type: "arc", innerRadius: 20, outerRadius: 35},
                encoding: {
                  theta: {
                    field: "Gender Percentage",
                    type: "quantitative"
                  },
                  color: {
                    field: "Gender",
                    type: "nominal",
                    scale: { 
                      range: [
                        "#B80065",      // dark pink
                        "#120174"       // dark blue
                      ] 
                    },
                    legend: { title: "Gender", titleFontSize: 16, labelFontSize: 15}
                  },
                  opacity: {
                    condition: {
                      test: "indexof(SelectedContinents, datum.Continent) >= 0 || indexof(SelectedContinents, 'Select All') >= 0",
                      value: 1
                    },
                    value: 0
                  },
                  tooltip: [
                    {field: "Continent",type: "nominal"},
                    {field: "Gender",type: "nominal"},
                    {field: "Gender Percentage",type: "quantitative", format: ".1f"}
                ]
                }
              },
              {
                mark: { 
                  type: "text", 
                  radius: 50,
                  fontSize: 14,
                  fontWeight: "bold"
                },
                encoding: {
                  theta: {
                    field: "Gender Percentage",
                    type: "quantitative",
                    stack: true
                  },
                  text: {
                    field: "Gender Percentage",
                    type: "quantitative",
                    format: ".1f"
                  },
                  color: {
                    field: "Gender",
                    type: "nominal",
                    scale: { 
                      range: [
                        "#B80065",
                        "#120174"
                      ] 
                    },
                    legend: null
                  },
                  opacity: {
                    condition: {
                      test: "indexof(SelectedContinents, datum.Continent) >= 0 || indexof(SelectedContinents, 'Select All') >= 0",
                      value: 1
                    },
                    value: 0
                  },
                }
              }
              
            ]
          }
        }, 
      ]
    },
        // Slope Graph
        {
          width: 500,
          height: 600,
          data: { url: "slope.csv" },
          config: {
            view: {
                stroke: null,
                fill: "#e5cefcfe"
            }
        },
          transform: [
            { filter: "indexof(SelectedContinents, 'Select All') >= 0 || indexof(SelectedContinents, datum.Continent) >= 0" }
          ],
           encoding: {
            x: { 
                field: "Measure",
                type: "nominal",
                sort: ["Incidence","Mortality"],
                scale: { paddingInner: 0.1, paddingOuter: 0.01 },
                axis: {
                    domain: false,
                    ticks: false, 
                    labels: true,
                    title: null,
                    labelAngle: 0,
                    labelAlign: "center",
                    labelBaseline: "top",
                    labelFontSize: 15,
                    orient: "top",
                    dy: 10,
                    labelExpr: "datum.label == 'Incidence' ? 'Incidence ASR' : datum.label == 'Mortality' ? 'Mortality ASR' : datum.label" 
                }
            },
            y: { 
                field: "Cancer ASR rate",
                type: "quantitative",
                scale: { domain: [80, 300]},
                axis: null
            },
            color: {
              field: "Continent",
              type: "nominal",
              scale: {
                domain: ["Africa", "Asia", "Europe", "North America", "Oceania", "South America"],
                range: [
                  "#1f77b4",  // dark blue
                  "#BA1766",  // dark pink
                  "#020303",  // black
                  "#d62728",  // dark red
                  "#6D2494",  // dark purple
                  "#8c564b"   // brown
                ],

              },
              legend: { title: "Continent", titleFontSize: 16, labelFontSize: 15, orient: "right"}
            }
          },

          layer: [
            {
              mark: { type: "line", strokeWidth: 2 },
              encoding: {
                detail: { field: "Continent" },
                color: { field: "Continent", type: "nominal"}
              }
            },
            {
              mark: { type: "point", filled: true, size: 70},
              encoding: {
                detail: { field: "Continent" },
                color: { field: "Continent", type: "nominal" },
                tooltip: [
                    { field: "Continent", type: "nominal" },
                    { field: "Measure", type: "nominal" },
                    { field: "Cancer ASR rate", type: "quantitative" }
                ]
              }
            },                      
          {
              transform: [
                  {
                        calculate: "datum.Measure == 'Mortality' ? 5: -45",
                        as: "labelOffsetdx"
                    },
                    {
                        calculate: "datum.Measure == 'Mortality' ? (datum.Continent == 'Europe' ? -5: datum.Continent == 'Oceania' ? -5 : datum.Continent == 'North America' ? 10 : datum.Continent == 'South America' ? -5 : datum.Continent == 'Asia' ? -3 : datum.Continent == 'Africa' ? 20 : 0) : (datum.Continent == 'Europe' ? -5 : datum.Continent == 'Oceania' ? -5 : datum.Continent == 'North America' ? -10 : datum.Continent == 'South America' ? -5 : datum.Continent == 'Asia' ? -5 : datum.Continent == 'Africa' ? -5 : 0)",
                        as: "labelOffsetdy"
                    }
                ],
                mark: {
                    type: "text",
                    align: "left",
                    baseline: "middle",
                    dx: { expr: "datum.labelOffsetdx" },
                    dy: { expr: "datum.labelOffsetdy" },
                    fontSize: 15,
                    fontWeight: "bold"
                },
                encoding: {
                    x: { field: "Measure", type: "nominal" },
                    y: { field: "Cancer ASR rate", type: "quantitative" },
                    text: { field: "Cancer ASR rate", type: "quantitative", format: ".1f" },
                    color: { field: "Continent", type: "nominal" },
                    detail: { field: "Continent" },
                }
            },
            {
              mark: { 
                  type: "rule", 
                  stroke: "black", 
                  strokeWidth: 1,
              }, 
              encoding: { 
                  x: { datum: "Incidence",type: "nominal", band: 0.5,},
                  y: { datum: 80 },
                  y2: { datum: 290 }
                } 
            },
            {
                mark: { 
                    type: "rule", 
                    stroke: "black", 
                    strokeWidth: 1 
                }, 
            encoding: { 
                x: { datum: "Mortality", type: "nominal", band: 0.5,  },
                y: { datum: 80 },
                y2: { datum: 290 }
            } 
        }
        ]
        },
        
    ],
    resolve: {
      scale: { color: "independent" },
      legend: { color: "independent" }
    }
      },
      
]
    };


    var v2Spec = {
      $schema: "https://vega.github.io/schema/vega-lite/v6.json",
      background: "#e5cefcfe",
      vconcat: [
        {
          data: { url: "dot_plot_data_check.csv" },
          width: 895,
          height: 600,
          encoding: {
            y: {
              field: "Cancer Type",
              type: "nominal",
              axis: { title: "Cancer Type", labelFontSize: 16, titleFontSize: 15 },
              sort: { field: "Number of Cases", op: "max", order: "descending" }
            },
            x: {
              field: "Number of Cases",
              type: "quantitative",
              axis: { title: "Number of Cases (logarithm scale) ", labelFontSize: 16, titleFontSize: 15, format: ",", grid: false },
              scale: { type: "log" },
            }
          },

          layer: [
            {
              mark: { type: "line", strokeWidth: 2, color: "black" },
              encoding: { detail: { field: "Cancer Type" } }
            },
            {
              mark: { type: "point", filled: true, size: 70 },
              encoding: {
                color: {
                  field: "Type of Cases",
                  type: "nominal",
                  scale: {
                    domain: ["Incidence", "Mortality"],
                    range: [
                      "#24524A", 
                      "#AD1D00"
                    ]
                  },
                  legend: { title: "Type of Cases", titleFontSize: 16, labelFontSize: 15, labels: ["Incidence, Mortality"]}
                },
                tooltip: [
                  { field: "Cancer Type", type: "nominal", title: "Cancer type" },
                  { field: "Type of Cases", type: "nominal", title: "Type of Cases" },
                  { field: "Number of Cases", type: "quantitative", title: "Number of Cases", format: "," }
                ]
              }
            },
          ]
        }
        ]
    }
    vegaEmbed("#combined", vlSpec, { actions: false });
    vegaEmbed("#dotchart", v2Spec, { actions: false });
  </script>
</body>
</html>